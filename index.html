<html>
<head>
  <title></title>
  <style type="text/css">
  svg {
    display: none;
    width: 100%;
    height: 100%;
  }
  
  svg.current {
    display: block;
  }
  
  polyline {
    fill:none;
    stroke:black;
    stroke-width:5;
    stroke-linecap:round;
    stroke-linejoin:round;
    
  }
  </style>
</head>
<body>
    <script type="text/javascript">
      function page() { return document.querySelector("svg.current") }
      function lastPolyline() { return document.querySelector("svg.current polyline:last-child") }
      function pressed(e, c) { return e.keyCode == c.charCodeAt(0) }
      
      function newPage() {
        var firstPage = !!document.querySelector("svg.current");
        var newPage = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        
        if(firstPage)
          newPage.innerHTML = page().innerHTML;
        
        makeCurrent(newPage);
        document.body.appendChild(newPage);
      }
      
      function makeCurrent(s) {
        var pages = document.querySelectorAll("svg");
        for (var i = pages.length - 1; i >= 0; i--) {
          pages[i].removeAttribute("class");
          disablePen(pages[i]);
        }
        
        enablePen(s);
        s.setAttribute("class", "current");
      }
      
      function enablePen(s) {
        s.onmousedown = function(e) {
          var newLine = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
          // newLine.setAttribute("points", e.offsetX + "," + e.offsetY + " ");
          s.appendChild(newLine);
          
          s.onmousemove = function(e) {
            var p = s.createSVGPoint();
            p.x = e.offsetX;
            p.y = e.offsetY;
            lastPolyline(s).points.appendItem(p);
          }
        }
        
        s.onmouseup = function() { s.onmousemove = undefined; }
      }
      
      function disablePen(s) {
        s.onmousedown = undefined;
        s.onmousemove = undefined;
        s.onmouseup = undefined;
      }
      
      function historyPrevious() {
        if(page().previousElementSibling)
          makeCurrent(page().previousElementSibling);
      }
      
      function historyNext() {
        if(page().nextElementSibling)
          makeCurrent(page().nextElementSibling);
      }
      
      document.onkeypress = function(e) {
        // undo
        if(pressed(e, "z")) { page().removeChild(lastPolyline()); }
        
        // new page
        if(pressed(e, "p")) { newPage(); }
                
        if(pressed(e, "<")) { historyPrevious(); }
        if(pressed(e, ">")) { historyNext(); }
      }
      
      newPage();
    </script>
</body>
</html>